#!/usr/bin/env bash

# Setting up the compilers
module load intel-oneapi-compilers/2024.1.0 intel-oneapi-mpi/2021.12.0

# Setting up device scaling
unset ZE_AFFINITY_MASK
export ZE_FLAT_DEVICE_HIERARCHY=COMPOSITE
export ONEAPI_DEVICE_SELECTOR=level_zero:0.0,0.1,1.0,1.1,2.0,2.1,3.0,3.1

case "$1" in
tile)
  export NP=1
  ;;
gpu)
  export NP=2
  ;;
half-node)
  export NP=4
  ;;
node)
  export NP=8
  ;;
*)
  echo Select one of tile/node/half-node/node
  exit
esac

export I_MPI_PIN_DOMAIN=12
export OMP_NUM_THREADS=12
export I_MPI_PIN_CELL=core
export MPICOMMAND="mpiexec -n $NP"

# Vendor
export VENDOR=INTEL

# For CUDA
# ARCH=sm_80

# Additional configuration
export NCPUS=$(nproc --all)
unset I_MPI_PMI_LIBRARY
